import{H as N,V as H,$ as b,h as J,p as w,U as G,B as X,u as Y,w as B,S as $,y as j,I as L,L as Q,l as u,d as n,a,b as O,D as P,e as z,T as g,A as S,z as V,f as y,x as m,C as W,t as Z,n as ee,J as k,i as K,r as ae,K as te,F as le,G as se}from"./index-6PeRYcw-.js";const re={class:"max-w-4xl mx-auto space-y-6"},ie={class:"card"},oe={class:"flex gap-2 mb-6"},de=["onClick"],ue={class:"text-2xl mb-1"},ne={class:"font-medium"},ve={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},ge={class:"mb-6"},ce={class:"grid grid-cols-3 gap-3"},me=["onClick"],pe={class:"font-medium text-sm"},xe={class:"mb-6"},ye={class:"flex items-center justify-between mb-2"},be=["href"],ke={class:"relative"},fe=["type"],he={class:"mb-6"},Ue={class:"flex items-center justify-between mb-2"},Ae={class:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400"},Se=["disabled"],Ke={key:0,class:"text-amber-500"},Ie=["disabled","placeholder"],Re={class:"mb-6"},Ce={key:0,class:"space-y-2"},we={key:1,class:"space-y-2"},Oe=["value"],Pe={key:0,class:"text-xs text-primary-600 dark:text-primary-400 mt-1"},ze={key:0,class:"mb-6"},Ve={class:"mt-4 space-y-4"},De={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},Te={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},Be={key:1,class:"mb-6",open:""},$e={class:"mt-4 space-y-4"},je={key:2,class:"mb-6",open:""},Le={class:"mt-4 space-y-4"},qe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},Ee={class:"flex gap-3"},Fe=["disabled"],Ne=N({__name:"SettingsView",setup(Me){const d=H(),r=b("text"),f=b({text:!1,image:!1,video:!1}),x=b({text:!1,image:!1,video:!1}),s=b({text:{provider:"zhipu",apiKey:"",baseUrl:"",model:"",maxTokens:4096,temperature:.7},image:{provider:"siliconflow",apiKey:"",baseUrl:"",model:"",imageSize:"1024",imageStyle:"vivid"},video:{provider:"siliconflow",apiKey:"",baseUrl:"",model:"",videoDuration:5,videoResolution:"720p"}});(()=>{const t=e=>{var c;const i=d.config[e],p=i?.provider||"zhipu",U=i?.providerApiKeys||{},A=i?.providerBaseUrls||{},l={text:j,image:$,video:B},C=A[p]||((c=l[e][p])==null?void 0:c.baseUrl)||"";return{provider:p,apiKey:U[p]||"",baseUrl:C,model:i?.model||"",...e==="text"&&{maxTokens:i?.maxTokens??4096,temperature:i?.temperature??.7},...e==="image"&&{imageSize:i?.imageSize??"1024",imageStyle:i?.imageStyle??"vivid"},...e==="video"&&{videoDuration:i?.videoDuration??5,videoResolution:i?.videoResolution??"720p"}}};s.value={text:t("text"),image:t("image"),video:t("video")}})(),J(()=>{try{["text","image","video"].forEach(t=>{var e,c;const i=(e=s.value[t])==null?void 0:e.provider;if(i&&d.config[t]){const p=(c=d.config[t].providerBaseUrls)==null?void 0:c[i];x.value[t]=!!p}})}catch(t){console.error("Failed to initialize customBaseUrl state:",t)}});const h=b({text:!1,image:!1,video:!1}),v=b({text:null,image:null,video:null}),o=w(()=>s.value[r.value]),I=w(()=>({text:Y,image:X,video:G})[r.value][o.value.provider]||[]),R=w(()=>({text:j,image:$,video:B})[r.value]);L(()=>o.value.provider,t=>{const e=d.config[r.value].providerBaseUrls[t];e?(o.value.baseUrl=e,x.value[r.value]=!0):(o.value.baseUrl=R.value[t].baseUrl,x.value[r.value]=t==="custom"),I.value.length>0&&(o.value.model=I.value[0]),o.value.apiKey=d.config[r.value].providerApiKeys[t]||""}),L(()=>o.value.provider,t=>{t==="custom"&&(x.value[r.value]=!0)});const q=[{key:"text",label:"文本生成",icon:"📝",desc:"用于内容创作、问答等"},{key:"image",label:"图像生成",icon:"🎨",desc:"用于商品图片、广告图等"},{key:"video",label:"视频生成",icon:"🎬",desc:"用于短视频、广告视频等"}],E=Object.entries(Q).map(([t,e])=>({value:t,label:e})),D=t=>({text:se,image:le,video:te})[r.value][t]||"",T=()=>{const t=r.value;d.updateModelConfig(t,{provider:s.value[t].provider,apiKey:s.value[t].apiKey,baseUrl:s.value[t].baseUrl,model:s.value[t].model,enabled:!!s.value[t].apiKey,...t==="text"&&{maxTokens:s.value.text.maxTokens,temperature:s.value.text.temperature},...t==="image"&&{imageSize:s.value.image.imageSize,imageStyle:s.value.image.imageStyle},...t==="video"&&{videoDuration:s.value.video.videoDuration,videoResolution:s.value.video.videoResolution}}),v.value[t]=null},F=async()=>{var t;const e=r.value;if(!s.value[e].apiKey){v.value[e]={success:!1,message:"请先填写 API Key"};return}h.value[e]=!0,v.value[e]=null;try{T();const c=d.getService(e);if(e==="text"){const i=await c.chat([{role:"user",content:"你好"}],"请用一句话回复");i.success?v.value[e]={success:!0,message:`连接成功！模型响应：${(t=i.content)==null?void 0:t.slice(0,50)}...`}:v.value[e]={success:!1,message:i.error||"连接失败"}}else e==="image"?v.value[e]={success:!0,message:"配置已保存！图像生成功能已就绪。"}:e==="video"&&(v.value[e]={success:!0,message:"配置已保存！视频生成功能已就绪。"})}catch(c){v.value[e]={success:!1,message:c instanceof Error?c.message:"连接失败"}}finally{h.value[e]=!1}},M=()=>{const t=r.value,e=R.value.zhipu;t==="text"?s.value.text={provider:"zhipu",apiKey:"",baseUrl:e.baseUrl,model:e.model,maxTokens:4096,temperature:.7}:t==="image"?s.value.image={provider:"zhipu",apiKey:"",baseUrl:e.baseUrl,model:e.model,imageSize:"1024",imageStyle:"vivid"}:t==="video"&&(s.value.video={provider:"zhipu",apiKey:"",baseUrl:e.baseUrl,model:e.model,videoDuration:5,videoResolution:"720p"}),x.value[t]=!1,d.resetModelConfig(t),v.value[t]=null},_=()=>{d.resetAllConfig(),s.value={text:{provider:d.config.text.provider,apiKey:d.config.text.apiKey,baseUrl:d.config.text.baseUrl,model:d.config.text.model,maxTokens:d.config.text.maxTokens||4096,temperature:d.config.text.temperature||.7},image:{provider:d.config.image.provider,apiKey:d.config.image.apiKey,baseUrl:d.config.image.baseUrl,model:d.config.image.model,imageSize:d.config.image.imageSize||"1024",imageStyle:d.config.image.imageStyle||"vivid"},video:{provider:d.config.video.provider,apiKey:d.config.video.apiKey,baseUrl:d.config.video.baseUrl,model:d.config.video.model,videoDuration:d.config.video.videoDuration||5,videoResolution:d.config.video.videoResolution||"720p"}},v.value={text:null,image:null,video:null}};return(t,e)=>{var c,i,p,U,A;return u(),n("div",re,[a("div",ie,[a("div",oe,[(u(),n(O,null,P(q,l=>a("button",{key:l.key,class:z(["flex-1 p-4 rounded-xl border-2 text-left transition-all",r.value===l.key?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]),onClick:C=>r.value=l.key},[a("div",ue,g(l.icon),1),a("div",ne,g(l.label),1),a("div",ve,g(l.desc),1)],10,de)),64))]),a("div",ge,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 选择 AI 提供商 ",-1)),a("div",ce,[(u(!0),n(O,null,P(S(E),l=>(u(),n("button",{key:l.value,class:z(["p-3 rounded-xl border-2 text-center transition-all",o.value.provider===l.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]),onClick:C=>o.value.provider=l.value},[a("div",pe,g(l.label),1)],10,me))),128))])]),a("div",xe,[a("div",ye,[e[13]||(e[13]=a("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"API Key",-1)),(c=S(V)[o.value.provider])!=null&&c.url?(u(),n("a",{key:0,href:S(V)[o.value.provider].url,target:"_blank",class:"text-xs text-primary-600 dark:text-primary-400 hover:underline"}," 获取 "+g(S(V)[o.value.provider].text)+" → ",9,be)):y("",!0)]),a("div",ke,[m(a("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.apiKey=l),type:f.value[r.value]?"text":"password",placeholder:"请输入你的 API Key",class:"input pr-20"},null,8,fe),[[W,o.value.apiKey]]),a("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:text-gray-300",onClick:e[1]||(e[1]=l=>f.value[r.value]=!f.value[r.value])},g(f.value[r.value]?"🙈":"👁️"),1)]),e[14]||(e[14]=a("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-2"}," 🔒 API Key 仅存储在本地浏览器中，不会上传到任何服务器 ",-1))]),a("div",he,[a("div",Ue,[e[16]||(e[16]=a("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"API Base URL",-1)),a("label",Ae,[m(a("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>x.value[r.value]=l),disabled:o.value.provider==="custom",type:"checkbox",class:"rounded"},null,8,Se),[[Z,x.value[r.value]]]),e[15]||(e[15]=ee(" 自定义 ",-1)),o.value.provider==="custom"?(u(),n("span",Ke,"（必填）")):y("",!0)])]),m(a("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.baseUrl=l),disabled:o.value.provider!=="custom"&&!x.value[r.value],placeholder:o.value.provider==="custom"?"请输入完整的API Base URL（例如：https://your-api.com/v1）":(i=R.value[o.value.provider])==null?void 0:i.baseUrl,class:"input disabled:bg-white dark:bg-gray-800 disabled:text-gray-500"},null,8,Ie),[[k,o.value.baseUrl]])]),a("div",Re,[e[17]||(e[17]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"模型",-1)),o.value.provider==="custom"?(u(),n("div",Ce,[m(a("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.model=l),type:"text",placeholder:"输入模型名称",class:"input"},null,512),[[k,o.value.model]])])):(u(),n("div",we,[m(a("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.model=l),class:"input"},[(u(!0),n(O,null,P(I.value,l=>(u(),n("option",{key:l,value:l},g(l),9,Oe))),128))],512),[[K,o.value.model]]),D(o.value.model)?(u(),n("p",Pe," 💡 "+g(D(o.value.model)),1)):y("",!0)]))]),r.value==="text"?(u(),n("details",ze,[e[20]||(e[20]=a("summary",{class:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-800 dark:text-gray-100"}," 高级设置 ",-1)),a("div",Ve,[a("div",null,[a("label",De," 最大输出长度 (Max Tokens): "+g(s.value.text.maxTokens),1),m(a("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.text.maxTokens=l),type:"range",min:"256",max:"8192",step:"256",class:"w-full"},null,512),[[k,s.value.text.maxTokens,void 0,{number:!0}]]),e[18]||(e[18]=a("div",{class:"flex justify-between text-xs text-gray-500 dark:text-gray-400"},[a("span",null,"256"),a("span",null,"8192")],-1))]),a("div",null,[a("label",Te," 创造性 (Temperature): "+g((s.value.text.temperature??.7).toFixed(1)),1),m(a("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.text.temperature=l),type:"range",min:"0",max:"1",step:"0.1",class:"w-full"},null,512),[[k,s.value.text.temperature,void 0,{number:!0}]]),e[19]||(e[19]=a("div",{class:"flex justify-between text-xs text-gray-500 dark:text-gray-400"},[a("span",null,"0 (精确)"),a("span",null,"1 (创造)")],-1))])])])):y("",!0),r.value==="image"?(u(),n("details",Be,[e[25]||(e[25]=a("summary",{class:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-800 dark:text-gray-100"}," 图像设置 ",-1)),a("div",$e,[a("div",null,[e[22]||(e[22]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 图像尺寸 ",-1)),m(a("select",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.image.imageSize=l),class:"input"},[...e[21]||(e[21]=[a("option",{value:"256"}," 256x256 ",-1),a("option",{value:"512"}," 512x512 ",-1),a("option",{value:"1024"}," 1024x1024 ",-1),a("option",{value:"1792"}," 1792x1792 ",-1)])],512),[[K,s.value.image.imageSize]])]),a("div",null,[e[24]||(e[24]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 图像风格 ",-1)),m(a("select",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.image.imageStyle=l),class:"input"},[...e[23]||(e[23]=[a("option",{value:"vivid"}," 生动 (Vivid) ",-1),a("option",{value:"natural"}," 自然 (Natural) ",-1)])],512),[[K,s.value.image.imageStyle]])])])])):y("",!0),r.value==="video"?(u(),n("details",je,[e[29]||(e[29]=a("summary",{class:"cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-800 dark:text-gray-100"}," 视频设置 ",-1)),a("div",Le,[a("div",null,[a("label",qe," 视频时长 (秒): "+g(s.value.video.videoDuration),1),m(a("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.video.videoDuration=l),type:"range",min:"1",max:"60",step:"1",class:"w-full"},null,512),[[k,s.value.video.videoDuration,void 0,{number:!0}]]),e[26]||(e[26]=a("div",{class:"flex justify-between text-xs text-gray-500 dark:text-gray-400"},[a("span",null,"1秒"),a("span",null,"60秒")],-1))]),a("div",null,[e[28]||(e[28]=a("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," 视频分辨率 ",-1)),m(a("select",{"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.video.videoResolution=l),class:"input"},[...e[27]||(e[27]=[a("option",{value:"480p"}," 480p ",-1),a("option",{value:"720p"}," 720p ",-1),a("option",{value:"1080p"}," 1080p ",-1)])],512),[[K,s.value.video.videoResolution]])])])])):y("",!0),a("div",Ee,[a("button",{class:"btn-primary flex-1",onClick:T}," 💾 保存配置 "),a("button",{disabled:h.value[r.value]||!o.value.apiKey,class:"btn-secondary flex-1",onClick:F},g(h.value[r.value]?"测试中...":"🔌 测试连接"),9,Fe)]),v.value[r.value]?(u(),n("div",{key:3,class:z(["mt-4 p-4 rounded-lg",(p=v.value[r.value])!=null&&p.success?"bg-success-50 dark:bg-success-900/20 text-success-300":"bg-danger-50 dark:bg-danger-900/20 text-danger-300"])},g((U=v.value[r.value])!=null&&U.success?"✅":"❌")+" "+g((A=v.value[r.value])==null?void 0:A.message),3)):y("",!0)]),e[32]||(e[32]=ae(`<div class="card bg-white dark:bg-gray-50 dark:bg-gray-800/50"><h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"> 📖 使用说明 </h3><div class="space-y-3 text-sm text-gray-500 dark:text-gray-400"><p><strong>1. 选择模型类型：</strong>根据你的需求选择文本、图像或视频生成模型。</p><p><strong>2. 选择提供商：</strong>选择你想要使用的 AI 服务提供商。</p><p><strong>3. 获取 API Key：</strong>点击右上角链接，在对应平台注册并获取 API Key。</p><p><strong>4. 填写并保存：</strong>将 API Key 填入并点击保存，即可开始使用。</p><p><strong>5. 数据安全：</strong>所有数据仅存储在你的浏览器本地，不会上传到服务器。</p></div><div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-blue-800 dark:text-blue-300"> 💡 <strong>推荐：</strong>智谱 AI 提供免费额度，适合个人用户试用。DeepSeek 价格实惠，OpenAI 功能强大但需要付费订阅。 </div></div><div class="card border-amber-200 dark:border-amber-800 bg-amber-50/50 dark:bg-amber-900/10"><h3 class="text-lg font-semibold text-amber-700 dark:text-amber-400 mb-3"> ⚠️ 重要：CORS跨域问题 </h3><div class="space-y-3 text-sm text-gray-600 dark:text-gray-400"><p><strong>为什么有些模型无法调用？</strong><br> 本应用直接在浏览器中调用AI服务商的API。大多数服务商（OpenAI、智谱、通义等）的API默认 <strong>不支持跨域访问</strong>，因此浏览器会阻止这些请求。 </p><p><strong>已确认支持跨域的提供商：</strong><br> ✅ <strong>DeepSeek</strong> - 完全支持CORS，可直接调用<br> ✅ <strong>硅基流动</strong> - 部分支持，建议配置CORS代理 </p><p><strong>解决方案：</strong></p><ul class="list-disc list-inside space-y-1 ml-2"><li><strong>方案A（推荐调试）：安装浏览器扩展</strong><br> 安装 &quot;Allow CORS&quot; 或 &quot;CORS Unblock&quot; 扩展，可临时禁用CORS检查，方便测试。 <span class="text-amber-600 dark:text-amber-400">注意：仅限开发测试，不适合生产环境长期使用。</span></li><li><strong>方案B：配置CORS代理</strong><br> 在 <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">src/services/ai.ts:8</code> 设置 <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">CORS_PROXY</code> 变量，通过代理服务器转发请求。 </li><li><strong>方案C：自建后端代理（生产推荐）</strong><br> 搭建简单的Node.js代理服务，API Key存储在服务端，既解决CORS问题，又保证安全性。 </li></ul></div></div><div class="card border-purple-200 dark:border-purple-800 bg-purple-50/50 dark:bg-purple-900/10"><h3 class="text-lg font-semibold text-purple-700 dark:text-purple-400 mb-3"> 🔧 自定义模型配置指南 </h3><div class="space-y-3 text-sm text-gray-600 dark:text-gray-400"><p> 如果你使用其他兼容OpenAI格式的AI服务（如本地部署的模型、其他云服务商），请选择 <strong>&quot;自定义&quot;</strong> 提供商： </p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3"><div class="p-3 bg-white dark:bg-gray-800 rounded-lg border"><h4 class="font-medium text-gray-800 dark:text-gray-200 mb-2"> 📋 配置要求 </h4><ul class="list-disc list-inside space-y-1 text-xs"><li><strong>Base URL：</strong>API的基础地址（必须）</li><li><strong>模型名称：</strong>完整的模型标识符（必须）</li><li><strong>API Key：</strong>认证密钥（可选，取决于服务商）</li></ul></div><div class="p-3 bg-white dark:bg-gray-800 rounded-lg border"><h4 class="font-medium text-gray-800 dark:text-gray-200 mb-2"> 📝 示例配置 </h4><pre class="text-xs bg-gray-50 dark:bg-gray-900 p-2 rounded overflow-x-auto"><code>Base URL: https://your-api.com/v1
模型名称: your-model-name
API Key: sk-xxx</code></pre></div></div><p class="text-amber-600 dark:text-amber-400 mt-2"> 💡 提示：自定义模型使用OpenAI兼容格式，确保你的服务支持 <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">/chat/completions</code> 端点。 </p></div></div><div class="card border-green-200 dark:border-green-800 bg-green-50/50 dark:bg-green-900/10"><h3 class="text-lg font-semibold text-green-700 dark:text-green-400 mb-3"> 🗂️ 模型类别兼容性说明 </h3><div class="space-y-2 text-sm text-gray-600 dark:text-gray-400"><p><strong>文本模型：</strong>所有提供商使用 <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">/chat/completions</code> 接口（OpenAI兼容格式）。</p><p><strong>图像模型：</strong></p><ul class="list-disc list-inside space-y-1 ml-4 text-xs"><li>OpenAI、智谱、硅基流动：使用 <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">/images/generations</code>（OpenAI兼容）</li><li>通义千问：使用原生API <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">/services/aigc/multimodal-generation/generation</code></li></ul><p><strong>视频模型：</strong></p><ul class="list-disc list-inside space-y-1 ml-4 text-xs"><li>智谱：使用 <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">/videos/generations</code></li><li>通义千问：使用原生API <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">/services/aigc/video-generation/video-synthesis</code></li><li>硅基流动：使用 <code class="px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-xs">/video/generations</code>（OpenAI兼容）</li></ul><p class="text-green-600 dark:text-green-400 mt-2"> ✅ 每个模型类型（文本/图像/视频）都有<strong>独立的Base URL配置</strong>，互不干扰！ </p></div></div>`,4)),a("div",{class:"card border-danger-200 dark:border-danger-800"},[e[30]||(e[30]=a("h3",{class:"text-lg font-semibold text-danger-600 dark:text-danger-400 mb-2"}," 危险操作 ",-1)),e[31]||(e[31]=a("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-4"}," 重置将清除所有本地保存的配置数据。 ",-1)),a("div",{class:"flex gap-3"},[a("button",{class:"btn bg-danger-500 text-white hover:bg-danger-600",onClick:M}," 重置当前配置 "),a("button",{class:"btn bg-danger-600 text-white hover:bg-danger-700",onClick:_}," 🗑️ 重置所有配置 ")])])])}}});export{Ne as default};
